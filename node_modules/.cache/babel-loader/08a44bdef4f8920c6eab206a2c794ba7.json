{"ast":null,"code":"import _toConsumableArray from\"C:/Users/Charu/Desktop/Project_Board-main/frontend/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _asyncToGenerator from\"C:/Users/Charu/Desktop/Project_Board-main/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/Users/Charu/Desktop/Project_Board-main/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"C:\\\\Users\\\\Charu\\\\Desktop\\\\Project_Board-main\\\\frontend\\\\node_modules\\\\@babel\\\\runtime\\\\regenerator\\\\index.js\";import React,{useState,useEffect,useContext}from'react';import{useNavigate,NavLink}from'react-router-dom';import'../stylesheets/messages.css';import'bootstrap/dist/css/bootstrap.min.css';import{Row,Col,Container,Form,Image,Button,ListGroup,Offcanvas,InputGroup,Modal}from'react-bootstrap';import image_S1 from'../images/abstract10.png';import image_S2 from'../images/abstract1.png';import{UserContext}from'../App';import io from\"socket.io-client\";import DeleteMember from'./DeleteMember';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var ENDPOINT=\"https://taskhive-hb9j.onrender.com\";var socket,currentChat;var Messages=function Messages(){var _useContext=useContext(UserContext),state=_useContext.state,dispatch=_useContext.dispatch;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),smShow=_useState2[0],setSmShow=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),smShowGroup=_useState4[0],setSmShowGroup=_useState4[1];var _useState5=useState(true),_useState6=_slicedToArray(_useState5,2),fullscreen=_useState6[0],setFullscreen=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),show=_useState8[0],setShow=_useState8[1];var handleShow=function handleShow(){setFullscreen(true);setShow(true);};var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),lgShow=_useState10[0],setLgShow=_useState10[1];var _useState11=useState(false),_useState12=_slicedToArray(_useState11,2),lgShowGroup=_useState12[0],setLgGroupShow=_useState12[1];var _useState13=useState([]),_useState14=_slicedToArray(_useState13,2),groupChats=_useState14[0],setGroupChats=_useState14[1];var _useState15=useState([]),_useState16=_slicedToArray(_useState15,2),allfriends=_useState16[0],setAllfriends=_useState16[1];var _useState17=useState(\"\"),_useState18=_slicedToArray(_useState17,2),selectedId=_useState18[0],setSelectedId=_useState18[1];var _useState19=useState(\"\"),_useState20=_slicedToArray(_useState19,2),txtInput=_useState20[0],setTxtInput=_useState20[1];var _useState21=useState([]),_useState22=_slicedToArray(_useState21,2),allMessages=_useState22[0],setAllMessages=_useState22[1];var _useState23=useState(false),_useState24=_slicedToArray(_useState23,2),userConnection=_useState24[0],setUserConnection=_useState24[1];var _useState25=useState(\"\"),_useState26=_slicedToArray(_useState25,2),selectedChatId=_useState26[0],setSelectedChatId=_useState26[1];var _useState27=useState(\"\"),_useState28=_slicedToArray(_useState27,2),senderchatId=_useState28[0],setSenderChatId=_useState28[1];var _useState29=useState([]),_useState30=_slicedToArray(_useState29,2),notification=_useState30[0],setNotification=_useState30[1];var userProfile=JSON.parse(localStorage.getItem(\"User\"));var handleHideSelectionModal=function handleHideSelectionModal(){setSmShow(false);};var handleHideSelectionModalGroup=function handleHideSelectionModalGroup(){setSmShowGroup(false);};var getAllChats=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var response,data;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return fetch('/allGroupChats',{method:'GET'});case 3:response=_context.sent;_context.next=6;return response.json();case 6:data=_context.sent;console.log(data);setGroupChats(data);_context.next=14;break;case 11:_context.prev=11;_context.t0=_context[\"catch\"](0);console.log(_context.t0);case 14:case\"end\":return _context.stop();}}},_callee,null,[[0,11]]);}));return function getAllChats(){return _ref.apply(this,arguments);};}();var getFriends=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var response,data;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return fetch('/getFriends',{method:'GET'});case 3:response=_context2.sent;_context2.next=6;return response.json();case 6:data=_context2.sent;console.log(data);setAllfriends(data);// console.log(senderProfiles)\n_context2.next=14;break;case 11:_context2.prev=11;_context2.t0=_context2[\"catch\"](0);console.log(_context2.t0);case 14:case\"end\":return _context2.stop();}}},_callee2,null,[[0,11]]);}));return function getFriends(){return _ref2.apply(this,arguments);};}();useEffect(function(){getFriends();getAllChats();socket=io(ENDPOINT);socket.emit(\"setUser\",userProfile);socket.on(\"User Connected\",function(){return setUserConnection(true);});},[]);var handleRefreshCompnent=function handleRefreshCompnent(){getFriends();getAllChats();};var handleGroupClick=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(e){var selectedId,response,data,getMessages,getChat;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:// console.log(e.target.id)\nsetSelectedId(e.target.id);selectedId=e.target.id;// console.log(e.target.id)\nsetSmShowGroup(true);_context3.prev=3;_context3.next=6;return fetch('/getAllGroupMsgs',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({selectedId:selectedId})});case 6:response=_context3.sent;_context3.next=9;return response.json();case 9:data=_context3.sent;getMessages=data.getAllMessages;getChat=data.chatExist;setSelectedChatId(getChat._id);setAllMessages(getMessages);socket.emit(\"joinSelectedChat\",getChat._id);_context3.next=20;break;case 17:_context3.prev=17;_context3.t0=_context3[\"catch\"](3);console.log(_context3.t0);case 20:case\"end\":return _context3.stop();}}},_callee3,null,[[3,17]]);}));return function handleGroupClick(_x){return _ref3.apply(this,arguments);};}();var handleClick=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(e){var selectedId,response,data,getMessages,getChat;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:// console.log(e.target.id)\nsetSelectedId(e.target.id);selectedId=e.target.id;// console.log(e.target.id)\nsetSmShow(true);_context4.prev=3;_context4.next=6;return fetch('/getAllMsgs',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({selectedId:selectedId})});case 6:response=_context4.sent;_context4.next=9;return response.json();case 9:data=_context4.sent;getMessages=data.getAllMessages;getChat=data.chatExist;setSelectedChatId(getChat._id);setAllMessages(getMessages);socket.emit(\"joinSelectedChat\",getChat._id);_context4.next=20;break;case 17:_context4.prev=17;_context4.t0=_context4[\"catch\"](3);console.log(_context4.t0);case 20:case\"end\":return _context4.stop();}}},_callee4,null,[[3,17]]);}));return function handleClick(_x2){return _ref4.apply(this,arguments);};}();// const handelChange = (e) =>{setTxtInput(e.target.value)}\nvar handleKeyDown=/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(e){var response,data;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:if(!(e.keyCode===13&&selectedId)){_context5.next=15;break;}_context5.prev=1;_context5.next=4;return fetch('/sendingMsg',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({selectedId:selectedId,txtInput:txtInput})// body: searchInput\n});case 4:response=_context5.sent;_context5.next=7;return response.json();case 7:data=_context5.sent;setSenderChatId(data.newMessage.ChatId);socket.emit(\"sendingMessage\",data);_context5.next=15;break;case 12:_context5.prev=12;_context5.t0=_context5[\"catch\"](1);console.log(_context5.t0);case 15:case\"end\":return _context5.stop();}}},_callee5,null,[[1,12]]);}));return function handleKeyDown(_x3){return _ref5.apply(this,arguments);};}();var handleSendBtn=/*#__PURE__*/function(){var _ref6=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(){var response,data;return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:_context6.prev=0;_context6.next=3;return fetch('/sendingMsg',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({selectedId:selectedId,txtInput:txtInput})// body: searchInput\n});case 3:response=_context6.sent;_context6.next=6;return response.json();case 6:data=_context6.sent;setSenderChatId(data.newMessage.ChatId);socket.emit(\"sendingMessage\",data);setTxtInput(\"\");_context6.next=15;break;case 12:_context6.prev=12;_context6.t0=_context6[\"catch\"](0);console.log(_context6.t0);case 15:case\"end\":return _context6.stop();}}},_callee6,null,[[0,12]]);}));return function handleSendBtn(){return _ref6.apply(this,arguments);};}();var handleKeyDownGroup=/*#__PURE__*/function(){var _ref7=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee7(e){var response,data;return _regeneratorRuntime.wrap(function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:if(!(e.keyCode===13&&selectedId)){_context7.next=15;break;}_context7.prev=1;_context7.next=4;return fetch('/sendingGroupMsg',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({selectedId:selectedId,txtInput:txtInput})// body: searchInput\n});case 4:response=_context7.sent;_context7.next=7;return response.json();case 7:data=_context7.sent;setSenderChatId(data.newMessage.ChatId);socket.emit(\"sendingMessage\",data);_context7.next=15;break;case 12:_context7.prev=12;_context7.t0=_context7[\"catch\"](1);console.log(_context7.t0);case 15:case\"end\":return _context7.stop();}}},_callee7,null,[[1,12]]);}));return function handleKeyDownGroup(_x4){return _ref7.apply(this,arguments);};}();var handleSendGroupBtn=/*#__PURE__*/function(){var _ref8=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee8(){var response,data;return _regeneratorRuntime.wrap(function _callee8$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:_context8.prev=0;_context8.next=3;return fetch('/sendingGroupMsg',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({selectedId:selectedId,txtInput:txtInput})// body: searchInput\n});case 3:response=_context8.sent;_context8.next=6;return response.json();case 6:data=_context8.sent;setSenderChatId(data.newMessage.ChatId);socket.emit(\"sendingMessage\",data);_context8.next=14;break;case 11:_context8.prev=11;_context8.t0=_context8[\"catch\"](0);console.log(_context8.t0);case 14:case\"end\":return _context8.stop();}}},_callee8,null,[[0,11]]);}));return function handleSendGroupBtn(){return _ref8.apply(this,arguments);};}();useEffect(function(){currentChat=selectedChatId;},[selectedChatId]);useEffect(function(){socket.on(\"messageRecieved\",function(newMessage){console.log(newMessage);if(!currentChat||currentChat!==newMessage.ChatId){console.log(newMessage);setNotification(function(notification){return[newMessage].concat(_toConsumableArray(notification));});socket.off(\"messageRecieved\");console.log(notification);}else{setAllMessages(function(allMessages){return[].concat(_toConsumableArray(allMessages),[newMessage]);});socket.off(\"messageRecieved\");}});console.log(allMessages);},[]);return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(ListGroup.Item,{className:\"navList\",onClick:handleShow,children:[/*#__PURE__*/_jsx(\"i\",{className:\"far fa-comments\",children:\"\\xA0\"}),' ',\"Chat Box\"]}),/*#__PURE__*/_jsxs(Modal,{show:show,fullscreen:fullscreen,onHide:function onHide(){return setShow(false);},children:[/*#__PURE__*/_jsxs(Modal.Header,{closeButton:true,className:\"modalHeader\",children:[/*#__PURE__*/_jsx(Modal.Title,{children:\"Chat Box\"}),/*#__PURE__*/_jsx(Button,{className:\"refreshBtn\",onClick:handleRefreshCompnent,children:/*#__PURE__*/_jsx(\"i\",{className:\"material-icons refreshIcon\",children:\"refresh\"})})]}),/*#__PURE__*/_jsx(Modal.Body,{className:\"modalBody\",children:/*#__PURE__*/_jsx(Container,{children:/*#__PURE__*/_jsxs(Row,{className:\"justify-content-md-center\",children:[allfriends.map(function(allfriends,index){return/*#__PURE__*/_jsxs(Col,{sm:true,lg:\"3\",children:[/*#__PURE__*/_jsxs(ListGroup.Item,{as:\"li\",id:allfriends._id,onClick:handleClick,className:\"profileMessages\",children:[/*#__PURE__*/_jsx(\"img\",{src:allfriends.image,id:allfriends._id,onClick:handleClick,onError:function onError(e){e.target.onError=null;e.target.src=image_S1;},className:\"profileImages\"}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"b\",{children:allfriends.name})]}),/*#__PURE__*/_jsx(\"br\",{})]},index);}),groupChats.map(function(element,index){return/*#__PURE__*/_jsxs(Col,{sm:true,lg:\"3\",children:[/*#__PURE__*/_jsxs(ListGroup.Item,{as:\"li\",id:element._id,onClick:handleGroupClick,className:\"profileMessages\",children:[/*#__PURE__*/_jsx(\"img\",{src:image_S2,id:element._id,onClick:handleGroupClick,onError:function onError(e){e.target.onError=null;e.target.src=image_S1;},className:\"profileImages\"}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"b\",{children:element.groupName})]}),/*#__PURE__*/_jsx(\"br\",{})]},index);})]})})})]}),/*#__PURE__*/_jsxs(Modal,{size:\"sm\",show:smShow,onHide:handleHideSelectionModal,\"aria-labelledby\":\"example-modal-sizes-title-sm\",children:[/*#__PURE__*/_jsx(Modal.Header,{closeButton:true,className:\"modalHeader\",children:/*#__PURE__*/_jsx(Modal.Title,{id:\"example-modal-sizes-title-sm\",className:\"titleSelection\",children:\"Choose For Selected Member\"})}),/*#__PURE__*/_jsxs(Modal.Body,{className:\"modalBody\",children:[/*#__PURE__*/_jsxs(ListGroup.Item,{className:\"selectedListItem\",onClick:function onClick(){return setLgShow(true);},children:[/*#__PURE__*/_jsx(\"i\",{className:\"far fa-comments\"}),/*#__PURE__*/_jsx(\"br\",{}),\"Start Chat\"]}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(DeleteMember,{})]})]}),/*#__PURE__*/_jsxs(Modal,{size:\"lg\",show:lgShow,onHide:function onHide(){return setLgShow(false);},backdrop:\"static\",keyboard:false,\"aria-labelledby\":\"example-modal-sizes-title-lg\",children:[/*#__PURE__*/_jsx(Modal.Header,{closeButton:true,className:\"modalHeader\",children:/*#__PURE__*/_jsx(Modal.Title,{id:\"example-modal-sizes-title-lg\",children:\"Chat\"})}),/*#__PURE__*/_jsx(Modal.Body,{className:\"modalBodyMsg\",children:selectedId?/*#__PURE__*/_jsx(Container,{children:/*#__PURE__*/_jsx(ListGroup,{children:allMessages.map(function(allMessages,index){return/*#__PURE__*/_jsx(ListGroup.Item,{className:allMessages.sender===state.id?\"myMsgs\":\"otherMsgs\",children:/*#__PURE__*/_jsxs(\"p\",{className:\"msgtxt\",children:[\" \",allMessages.message]})},index);})})}):/*#__PURE__*/_jsx(Container,{})}),/*#__PURE__*/_jsx(Modal.Footer,{className:\"modalFooter\",children:selectedId?/*#__PURE__*/_jsx(Container,{children:/*#__PURE__*/_jsxs(InputGroup,{className:\"mb-3\",children:[/*#__PURE__*/_jsx(Form.Control,{placeholder:\"Message\",className:\"formInput\",value:txtInput,onChange:function onChange(e){return setTxtInput(e.target.value);},onKeyDown:handleKeyDown}),/*#__PURE__*/_jsx(Button,{variant:\"outline-secondary\",className:\"searchBtn\",id:\"button-addon2\",onClick:handleSendBtn,children:/*#__PURE__*/_jsx(\"i\",{className:\"fa fa-paper-plane\"})})]})}):/*#__PURE__*/_jsx(Container,{})})]}),/*#__PURE__*/_jsxs(Modal,{size:\"sm\",show:smShowGroup,onHide:handleHideSelectionModalGroup,\"aria-labelledby\":\"example-modal-sizes-title-sm\",children:[/*#__PURE__*/_jsx(Modal.Header,{closeButton:true,className:\"modalHeader\",children:/*#__PURE__*/_jsx(Modal.Title,{id:\"example-modal-sizes-title-sm\",className:\"titleSelection\",children:\"Choose For Selected Group\"})}),/*#__PURE__*/_jsxs(Modal.Body,{className:\"modalBody\",children:[/*#__PURE__*/_jsxs(ListGroup.Item,{className:\"selectedListItem\",onClick:function onClick(){return setLgGroupShow(true);},children:[/*#__PURE__*/_jsx(\"i\",{className:\"far fa-comments\"}),/*#__PURE__*/_jsx(\"br\",{}),\"Start Chat\"]}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(DeleteMember,{})]})]}),/*#__PURE__*/_jsxs(Modal,{size:\"lg\",show:lgShowGroup,onHide:function onHide(){return setLgGroupShow(false);},backdrop:\"static\",keyboard:false,\"aria-labelledby\":\"example-modal-sizes-title-lg\",children:[/*#__PURE__*/_jsx(Modal.Header,{closeButton:true,className:\"modalHeader\",children:/*#__PURE__*/_jsx(Modal.Title,{id:\"example-modal-sizes-title-lg\",children:\"Chat\"})}),/*#__PURE__*/_jsx(Modal.Body,{className:\"modalBodyMsg\",children:selectedId?/*#__PURE__*/_jsx(Container,{children:/*#__PURE__*/_jsx(ListGroup,{children:allMessages.map(function(allMessages,index){return/*#__PURE__*/_jsx(ListGroup.Item,{className:allMessages.sender===state.id?\"myMsgs\":\"otherMsgs\",children:/*#__PURE__*/_jsxs(\"p\",{className:\"msgtxt\",children:[\" \",allMessages.message]})},index);})})}):/*#__PURE__*/_jsx(Container,{})}),/*#__PURE__*/_jsx(Modal.Footer,{className:\"modalFooter\",children:selectedId?/*#__PURE__*/_jsx(Container,{children:/*#__PURE__*/_jsxs(InputGroup,{className:\"mb-3\",children:[/*#__PURE__*/_jsx(Form.Control,{placeholder:\"Message\",className:\"formInput\",value:txtInput,onChange:function onChange(e){return setTxtInput(e.target.value);},onKeyDown:handleKeyDownGroup}),/*#__PURE__*/_jsx(Button,{variant:\"outline-secondary\",className:\"searchBtn\",id:\"button-addon2\",onClick:handleSendGroupBtn,children:/*#__PURE__*/_jsx(\"i\",{className:\"fa fa-paper-plane\"})})]})}):/*#__PURE__*/_jsx(Container,{})})]})]});};export default Messages;","map":{"version":3,"sources":["C:/Users/Charu/Desktop/Project_Board-main/frontend/src/components/Messages.js"],"names":["React","useState","useEffect","useContext","useNavigate","NavLink","Row","Col","Container","Form","Image","Button","ListGroup","Offcanvas","InputGroup","Modal","image_S1","image_S2","UserContext","io","DeleteMember","ENDPOINT","socket","currentChat","Messages","state","dispatch","smShow","setSmShow","smShowGroup","setSmShowGroup","fullscreen","setFullscreen","show","setShow","handleShow","lgShow","setLgShow","lgShowGroup","setLgGroupShow","groupChats","setGroupChats","allfriends","setAllfriends","selectedId","setSelectedId","txtInput","setTxtInput","allMessages","setAllMessages","userConnection","setUserConnection","selectedChatId","setSelectedChatId","senderchatId","setSenderChatId","notification","setNotification","userProfile","JSON","parse","localStorage","getItem","handleHideSelectionModal","handleHideSelectionModalGroup","getAllChats","fetch","method","response","json","data","console","log","getFriends","emit","on","handleRefreshCompnent","handleGroupClick","e","target","id","headers","body","stringify","getMessages","getAllMessages","getChat","chatExist","_id","handleClick","handleKeyDown","keyCode","newMessage","ChatId","handleSendBtn","handleKeyDownGroup","handleSendGroupBtn","off","map","index","image","onError","src","name","element","groupName","sender","message","value"],"mappings":"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","sourcesContent":["import React, {useState, useEffect, useContext} from 'react'\nimport { useNavigate, NavLink } from 'react-router-dom'\nimport '../stylesheets/messages.css'\nimport 'bootstrap/dist/css/bootstrap.min.css';\nimport { Row, Col,Container, Form, Image, Button, ListGroup, Offcanvas, InputGroup, Modal } from 'react-bootstrap';\nimport image_S1 from '../images/abstract10.png'\nimport image_S2 from '../images/abstract1.png'\nimport { UserContext } from '../App'\nimport io from \"socket.io-client\";\nimport DeleteMember from './DeleteMember';\n\nconst ENDPOINT = \"https://taskhive-hb9j.onrender.com\"\nvar socket, currentChat;\n\nconst Messages = () => {\n\n    const {state, dispatch} = useContext(UserContext);\n    const [smShow, setSmShow] = useState(false);\n    const [smShowGroup, setSmShowGroup] = useState(false);\n    const [fullscreen, setFullscreen] = useState(true);\n    const [show, setShow] = useState(false);\n    const handleShow = () => {setFullscreen(true); setShow(true);}\n    const [lgShow, setLgShow] = useState(false);\n    const [lgShowGroup, setLgGroupShow] = useState(false);\n    const [groupChats, setGroupChats] = useState([]);\n    const [allfriends, setAllfriends] = useState([]);\n    const [selectedId, setSelectedId] = useState(\"\");\n    const [txtInput, setTxtInput] = useState(\"\");\n    const [allMessages, setAllMessages] = useState([]);\n    const [userConnection, setUserConnection] = useState(false);\n    const [selectedChatId, setSelectedChatId] = useState(\"\");\n    const [senderchatId, setSenderChatId] = useState(\"\");\n    const [notification, setNotification] = useState([]);\n    const userProfile = JSON.parse(localStorage.getItem(\"User\")); \n\n    const handleHideSelectionModal = () =>{\n        setSmShow(false);\n    }\n\n    const handleHideSelectionModalGroup = () =>{\n        setSmShowGroup(false);\n    }\n\n\n    const getAllChats = async () =>{\n        try {\n            const response = await fetch('/allGroupChats', {\n                method: 'GET',\n            })\n\n            const data = await response.json();\n            console.log(data)\n            setGroupChats(data);\n\n        } catch (error) {\n            console.log(error)\n        }\n\n    }\n    \n    \n\n    const getFriends = async () =>{\n        try {\n            const response = await fetch('/getFriends', {\n                method: 'GET',\n            })\n\n            const data = await response.json();\n            console.log(data)\n            setAllfriends(data);\n            // console.log(senderProfiles)\n\n        } catch (error) {\n            console.log(error)\n        }\n\n    }\n\n    useEffect(() => {\n        getFriends();\n        getAllChats();\n        socket = io(ENDPOINT);\n        socket.emit(\"setUser\", userProfile);\n        socket.on(\"User Connected\", () => setUserConnection(true));\n    },[])\n\n\n    const handleRefreshCompnent = () =>{\n        getFriends();\n        getAllChats();\n    }\n\n\n\n    const handleGroupClick = async (e) =>{\n        // console.log(e.target.id)\n        setSelectedId(e.target.id)\n        let selectedId = e.target.id;\n        // console.log(e.target.id)\n        setSmShowGroup(true);\n\n        try { \n            const response = await fetch('/getAllGroupMsgs', {  \n                method: 'POST',\n                headers: {\n                    'Content-Type' : 'application/json' \n                },\n                body: JSON.stringify({selectedId}),\n            });\n\n            const data = await response.json();\n            let getMessages = data.getAllMessages;\n            let getChat = data.chatExist;\n            setSelectedChatId(getChat._id);\n            setAllMessages(getMessages);\n\n            socket.emit(\"joinSelectedChat\", getChat._id);\n\n\n        } catch (error) {\n            console.log(error)\n        }  \n        \n    }\n\n\n\n    const handleClick = async (e) =>{\n        // console.log(e.target.id)\n        setSelectedId(e.target.id)\n        let selectedId = e.target.id;\n        // console.log(e.target.id)\n        setSmShow(true);\n\n        try {\n            const response = await fetch('/getAllMsgs', {  \n                method: 'POST',\n                headers: {\n                    'Content-Type' : 'application/json' \n                },\n                body: JSON.stringify({selectedId}),\n            });\n\n            const data = await response.json();\n            let getMessages = data.getAllMessages;\n            let getChat = data.chatExist;\n            setSelectedChatId(getChat._id);\n            setAllMessages(getMessages);\n\n            socket.emit(\"joinSelectedChat\", getChat._id);\n\n\n        } catch (error) {\n            console.log(error)\n        }  \n        \n    }\n\n\n\n    // const handelChange = (e) =>{setTxtInput(e.target.value)}\n\n    const handleKeyDown = async (e) =>{\n        if(e.keyCode === 13 && selectedId){\n            try {\n                const response = await fetch('/sendingMsg', {\n                    method: 'POST',\n                    headers: {\n                        'Content-Type' : 'application/json' \n                    },\n                    body: JSON.stringify({selectedId, txtInput}),\n                    // body: searchInput\n                })\n                \n                let data = await response.json();\n               \n                setSenderChatId(data.newMessage.ChatId)\n                socket.emit(\"sendingMessage\", data)\n    \n            } catch (error) {\n                console.log(error)\n            }\n        }\n        \n    }\n\n    const handleSendBtn = async () =>{\n\n        try {\n            const response = await fetch('/sendingMsg', {\n                method: 'POST',\n                headers: {\n                    'Content-Type' : 'application/json' \n                },\n                body: JSON.stringify({selectedId, txtInput}),\n                // body: searchInput\n            })\n            \n            let data = await response.json();\n           \n            setSenderChatId(data.newMessage.ChatId)\n            socket.emit(\"sendingMessage\", data)\n            setTxtInput(\"\");\n\n        } catch (error) {\n            console.log(error)\n        }\n    }\n\n\n    const handleKeyDownGroup = async (e) =>{\n        if(e.keyCode === 13 && selectedId){\n            try {\n                const response = await fetch('/sendingGroupMsg', {\n                    method: 'POST',\n                    headers: {\n                        'Content-Type' : 'application/json' \n                    },\n                    body: JSON.stringify({selectedId, txtInput}),\n                    // body: searchInput\n                })\n                \n                let data = await response.json();\n               \n                setSenderChatId(data.newMessage.ChatId)\n                socket.emit(\"sendingMessage\", data)\n    \n            } catch (error) {\n                console.log(error)\n            }\n        }\n        \n    }\n\n    const handleSendGroupBtn = async () =>{\n        try {\n            const response = await fetch('/sendingGroupMsg', {\n                method: 'POST',\n                headers: {\n                    'Content-Type' : 'application/json' \n                },\n                body: JSON.stringify({selectedId, txtInput}),\n                // body: searchInput\n            })\n            \n            let data = await response.json();\n           \n            setSenderChatId(data.newMessage.ChatId)\n            socket.emit(\"sendingMessage\", data)\n\n        } catch (error) {\n            console.log(error)\n        }\n    }\n \n\n\n    useEffect(() => {\n        currentChat = selectedChatId\n\n    }, [selectedChatId])\n\n    useEffect(() => {\n        socket.on(\"messageRecieved\", (newMessage) =>{\n            console.log(newMessage)    \n            if(!currentChat || currentChat !== newMessage.ChatId){\n                console.log(newMessage)\n                setNotification(notification => [newMessage, ...notification]);\n                socket.off(\"messageRecieved\");\n                console.log(notification)\n            } \n            else{  \n            setAllMessages(allMessages => [...allMessages, newMessage]);\n            socket.off(\"messageRecieved\");\n            }\n        });\n        console.log(allMessages)\n        \n    },[])\n\n\n\n  return (\n    <>\n          \n        <ListGroup.Item className='navList' onClick={handleShow}>\n            <i className='far fa-comments'>&nbsp;</i>         \n            {' '}\n            Chat Box \n        </ListGroup.Item>\n       \n     \n        <Modal show={show} fullscreen={fullscreen} onHide={() => setShow(false)}>\n            <Modal.Header closeButton className='modalHeader'>\n                <Modal.Title>Chat Box</Modal.Title>\n                <Button className='refreshBtn' onClick={handleRefreshCompnent}><i className=\"material-icons refreshIcon\">refresh</i></Button>\n            </Modal.Header>\n        <Modal.Body className='modalBody'>\n            <Container>\n                <Row className=\"justify-content-md-center\">\n                    {allfriends.map( (allfriends, index) =>\n                        <Col sm lg=\"3\" key={index}>\n                            <ListGroup.Item as=\"li\"  id={allfriends._id} onClick={handleClick} className=\"profileMessages\">\n                                <img \n                                    src={allfriends.image}\n                                    id={allfriends._id}\n                                    onClick={handleClick}\n                                    onError={(e)=>{e.target.onError = null; e.target.src = image_S1}}\n                                    className=\"profileImages\"\n                                />\n                                <br></br>\n                                <b>{allfriends.name}</b>\n                            </ListGroup.Item>\n                            <br></br>\n                        </Col>\n                    )}\n                    {groupChats.map( (element, index) =>\n                        <Col sm lg=\"3\" key={index}>\n                            <ListGroup.Item as=\"li\"  id={element._id} onClick={handleGroupClick} className=\"profileMessages\">\n                                <img \n                                    src={image_S2}\n                                    id={element._id}\n                                    onClick={handleGroupClick}\n                                    onError={(e)=>{e.target.onError = null; e.target.src = image_S1}}\n                                    className=\"profileImages\"\n                                />\n                                <br></br>\n                                <b>{element.groupName}</b>\n                            </ListGroup.Item>\n                            <br></br>\n                        </Col>\n                    )}\n                </Row>  \n            </Container>     \n        </Modal.Body>\n      </Modal>\n\n\n\n\n      <Modal size=\"sm\" show={smShow} onHide={handleHideSelectionModal} aria-labelledby=\"example-modal-sizes-title-sm\" >\n            <Modal.Header closeButton className='modalHeader'>\n                <Modal.Title id=\"example-modal-sizes-title-sm\" className='titleSelection'>\n                    Choose For Selected Member\n                </Modal.Title>\n            </Modal.Header>\n            <Modal.Body className='modalBody'>\n\n                <ListGroup.Item className='selectedListItem' onClick={() => setLgShow(true)}>\n                    <i className='far fa-comments'></i>         \n                    <br></br>\n                    Start Chat\n                </ListGroup.Item>\n\n                <br></br>\n\n                <DeleteMember/>\n\n            </Modal.Body>\n        </Modal>\n\n\n\n      <Modal size=\"lg\" show={lgShow} onHide={() => setLgShow(false)} backdrop=\"static\" keyboard={false} aria-labelledby=\"example-modal-sizes-title-lg\">\n        <Modal.Header closeButton className='modalHeader'>\n          <Modal.Title id=\"example-modal-sizes-title-lg\">\n            Chat\n          </Modal.Title>\n        </Modal.Header>\n        <Modal.Body className='modalBodyMsg'>\n            {selectedId ?\n                <Container>  \n                    <ListGroup>                 \n                    {allMessages.map( (allMessages, index) =>                              \n                        <ListGroup.Item className={allMessages.sender === state.id ? \"myMsgs\" : \"otherMsgs\"} key={index}>\n                            <p className='msgtxt'> {allMessages.message}</p> \n                        </ListGroup.Item>                        \n                    )}\n                    </ListGroup>\n                </Container>\n            :\n                <Container></Container>\n            }\n        </Modal.Body>\n        <Modal.Footer className='modalFooter'>\n            {selectedId ?\n                <Container>        \n                    <InputGroup className=\"mb-3\">\n                        <Form.Control placeholder=\"Message\" className='formInput' value={txtInput} onChange={(e) => setTxtInput(e.target.value)} onKeyDown={handleKeyDown} />\n                        <Button variant=\"outline-secondary\" className='searchBtn' id=\"button-addon2\" onClick={handleSendBtn}>\n                            <i className=\"fa fa-paper-plane\"></i>\n                        </Button>\n                    </InputGroup>\n                </Container>\n            :\n                <Container></Container>\n            }\n        </Modal.Footer>\n      </Modal>\n\n\n\n\n\n\n\n\n      <Modal size=\"sm\" show={smShowGroup} onHide={handleHideSelectionModalGroup} aria-labelledby=\"example-modal-sizes-title-sm\" >\n            <Modal.Header closeButton className='modalHeader'>\n                <Modal.Title id=\"example-modal-sizes-title-sm\" className='titleSelection'>\n                    Choose For Selected Group\n                </Modal.Title>\n            </Modal.Header>\n            <Modal.Body className='modalBody'>\n\n                <ListGroup.Item className='selectedListItem' onClick={() => setLgGroupShow(true)}>\n                    <i className='far fa-comments'></i>         \n                    <br></br>\n                    Start Chat\n                </ListGroup.Item>\n\n                <br></br>\n\n                <DeleteMember/>\n\n            </Modal.Body>\n        </Modal>\n\n            {/* group chat */}\n\n      <Modal size=\"lg\" show={lgShowGroup} onHide={() => setLgGroupShow(false)} backdrop=\"static\" keyboard={false} aria-labelledby=\"example-modal-sizes-title-lg\">\n        <Modal.Header closeButton className='modalHeader'>\n          <Modal.Title id=\"example-modal-sizes-title-lg\">\n            Chat\n          </Modal.Title>\n        </Modal.Header>\n        <Modal.Body className='modalBodyMsg'>\n            {selectedId ?\n                <Container>  \n                    <ListGroup>                 \n                    {allMessages.map( (allMessages, index) =>                              \n                        <ListGroup.Item className={allMessages.sender === state.id ? \"myMsgs\" : \"otherMsgs\"} key={index}>\n                            <p className='msgtxt'> {allMessages.message}</p> \n                        </ListGroup.Item>                        \n                    )}\n                    </ListGroup>\n                </Container>\n            :\n                <Container></Container>\n            }\n        </Modal.Body>\n        <Modal.Footer className='modalFooter'>\n            {selectedId ?\n                <Container>        \n                    <InputGroup className=\"mb-3\">\n                        <Form.Control placeholder=\"Message\" className='formInput' value={txtInput} onChange={(e) => setTxtInput(e.target.value)} onKeyDown={handleKeyDownGroup} />\n                        <Button variant=\"outline-secondary\" className='searchBtn' id=\"button-addon2\" onClick={handleSendGroupBtn}>\n                            <i className=\"fa fa-paper-plane\"></i>\n                        </Button>\n                    </InputGroup>\n                </Container>\n            :\n                <Container></Container>\n            }\n        </Modal.Footer>\n      </Modal>\n    \n\n    </>\n  )\n}\n\nexport default Messages"]},"metadata":{},"sourceType":"module"}